# Identifying User Added to Domain Admins Group
## Forensic Analysis Guide
**Exercise Author**: Andy Macready 
**Latest Update**: February 15, 2026  

---

## Question:
**"Jennifer Hayes performed a DCSync and added a user to Domain Admins. How can we determine which specific user was added based on the logs?"**

---

## Answer: BackupAdmin

The user added to the Domain Admins group was **BackupAdmin**, created at **11:12:15 UTC** and added to Domain Admins at **11:12:16 UTC**.

---

## How to Identify This in the Logs

### Method 1: Active Directory Audit Logs (Best Source)

**Location:** `logs/active_directory_audit.log`

#### Step 1: Search for User Creation Events

**Event ID 5137** - Directory Object Created

```
TimeCreated: 2026-02-03T11:12:15.123Z
EventID: 5137
Computer: DC01.contoso.local
Message: A directory service object was created.

Subject:
  Account Name: jennifer.hayes@CONTOSO.LOCAL
  
Object:
  Object Class: user
  Object DN: CN=BackupAdmin,CN=Users,DC=contoso,DC=local
  Object GUID: {7c8d9e0f-1a2b-3c4d-5e6f-7a8b9c0d1e2f}
  
Additional Information:
  Attributes Set:
    - sAMAccountName: BackupAdmin
    - userPrincipalName: BackupAdmin@contoso.local
    - displayName: Backup Administrator
```

**Analysis:**
- ✅ New user "BackupAdmin" created
- ✅ Created by jennifer.hayes (compromised Domain Admin account)
- ✅ Created at 11:12:15 UTC (1 second before group add)

---

#### Step 2: Search for Group Membership Changes

**Event ID 4728** - Member Added to Security-Enabled Global Group

```
TimeCreated: 2026-02-03T11:12:16.234Z
EventID: 4728
Computer: DC01.contoso.local
Message: A member was added to a security-enabled global group.

Subject:
  Account Name: jennifer.hayes@CONTOSO.LOCAL
  Logon ID: 0xAD4E5
  
Member Added:
  Security ID: S-1-5-21-1234567890-1234567890-1234567890-2001
  Account Name: CN=BackupAdmin,CN=Users,DC=contoso,DC=local
  
Target Group:
  Security ID: S-1-5-21-1234567890-1234567890-1234567890-512
  Group Name: Domain Admins
  Group Domain: CONTOSO
```

**Analysis:**
- ✅ BackupAdmin added to Domain Admins group
- ✅ Added by jennifer.hayes
- ✅ Target group SID ends in -512 (Domain Admins)
- ✅ Added at 11:12:16 UTC (1 second after creation)

---

### Method 2: Windows Security Logs on DC01

**Location:** `logs/dc01_security.log`

#### Event ID 4720 - User Account Created

```
TimeCreated: 2026-02-03T11:12:15.123Z
EventID: 4720
Computer: DC01.contoso.local

Subject:
  Account Name: jennifer.hayes
  Account Domain: CONTOSO
  
New Account:
  Security ID: S-1-5-21-1234567890-1234567890-1234567890-2001
  Account Name: BackupAdmin
  Account Domain: CONTOSO
```

#### Event ID 4728 - Member Added to Global Group

```
TimeCreated: 2026-02-03T11:12:16.234Z
EventID: 4728

Subject:
  Account Name: jennifer.hayes
  
Member:
  Security ID: S-1-5-21-1234567890-1234567890-1234567890-2001
  Account Name: CN=BackupAdmin,CN=Users,DC=contoso,DC=local
  
Group:
  Security ID: S-1-5-21-1234567890-1234567890-1234567890-512
  Group Name: Domain Admins
```

---

### Method 3: Unified Timeline Analysis

**Location:** `unified_timeline.csv`, `unified_timeline_with_noise.csv`, or `unified_timeline_enterprise.csv`

#### Search Strategy:

```bash
# Search for Event 4728 (Domain Admins group changes)
grep "4728" unified_timeline.csv

# Search for "BackupAdmin" user
grep -i "backupadmin" unified_timeline.csv

# Search for group membership changes around 11:12 UTC
grep "11:12" unified_timeline.csv | grep -E "4728|4720|4732"
```

#### Timeline Entries:

**11:12:15 UTC - User Creation:**
```csv
2026-02-03 11:12:15.123,DC01,Security,4720,Account_Management,CONTOSO\jennifer.hayes,...
Details: "User account created: BackupAdmin by jennifer.hayes"
```

**11:12:16 UTC - Domain Admins Addition:**
```csv
2026-02-03 11:12:16.234,DC01,Security,4728,Group_Membership_Change,CONTOSO\jennifer.hayes,...
Details: "Member added to Domain Admins: BackupAdmin"
```

**11:12:18 UTC - Local Admins Addition:**
```csv
2026-02-03 11:12:18.567,DC01,Security,4732,Group_Membership_Change,CONTOSO\jennifer.hayes,...
Details: "Member added to Administrators: BackupAdmin"
```

---

## Key Event IDs for Domain Admins Analysis

| Event ID | Log Source | Description | What to Look For |
|----------|-----------|-------------|------------------|
| **4720** | Security | User account created | New account name, created by whom |
| **4728** | Security | Member added to global group | Member name, target group (check SID -512) |
| **4732** | Security | Member added to local group | Member name, local Administrators group |
| **5137** | AD Audit | Directory object created | Object DN, attributes (sAMAccountName) |
| **5136** | AD Audit | Directory object modified | Attribute changes (unicodePwd) |

---

## Important Security Identifiers (SIDs)

### Well-Known Domain Group SIDs:
- **S-1-5-21-{domain}-512** = Domain Admins
- **S-1-5-21-{domain}-519** = Enterprise Admins
- **S-1-5-32-544** = Local Administrators (Built-in)

### In This Incident:
- **S-1-5-21-1234567890-1234567890-1234567890-512** = CONTOSO\Domain Admins
- **S-1-5-21-1234567890-1234567890-1234567890-2001** = CONTOSO\BackupAdmin (new account)
- **S-1-5-21-1234567890-1234567890-1234567890-1001** = CONTOSO\jennifer.hayes (attacker)

---

## Complete Attack Sequence

### 1. DCSync Attack (11:08:45 - 11:08:47 UTC)
- jennifer.hayes performed DCSync
- Extracted all domain password hashes
- Including krbtgt hash (Golden Ticket capability)

### 2. Persistence - Account Creation (11:12:15 UTC)
- **Event 4720** (Security) + **Event 5137** (AD Audit)
- Created: BackupAdmin
- Created by: jennifer.hayes
- Purpose: Persistent backdoor access

### 3. Privilege Escalation (11:12:16 UTC)
- **Event 4728** - Added BackupAdmin to **Domain Admins**
- Full domain administrative privileges granted
- Can access any system in the domain

### 4. Additional Privileges (11:12:18 UTC)
- **Event 4732** - Added BackupAdmin to **Administrators** (local)
- Local admin rights on all domain systems

### 5. Password Set (11:12:16 UTC)
- **Event 5136** - unicodePwd attribute modified
- Password set for BackupAdmin account
- Account enabled for remote access

---

## Detection Queries

### PowerShell (CSV Analysis)
```powershell
# Import timeline
$timeline = Import-Csv unified_timeline.csv

# Find Domain Admins group changes
$timeline | Where-Object { 
    $_.Event_ID -eq 4728 -and 
    $_.Details -match "Domain Admins" 
}

# Find new account creations followed by DA addition
$timeline | Where-Object { 
    $_.Event_ID -in @(4720, 4728) -and 
    $_.Timestamp -like "2026-02-03 11:12*" 
} | Sort-Object Timestamp
```

### Splunk Query
```spl
index=windows EventCode IN (4720, 4728, 4732, 5137) 
| search "BackupAdmin" OR "Domain Admins"
| table _time, EventCode, user, Account_Name, Group_Name
| sort _time
```

### KQL (Microsoft Sentinel)
```kql
SecurityEvent
| where EventID in (4720, 4728, 4732)
| where TimeGenerated between (datetime(2026-02-03T11:12:00) .. datetime(2026-02-03T11:13:00))
| where AccountName contains "BackupAdmin" or TargetAccount contains "Domain Admins"
| project TimeGenerated, EventID, AccountName, TargetAccount, SubjectUserName
| order by TimeGenerated asc
```

### Command Line (Linux/Mac)
```bash
# Search for BackupAdmin in timeline
grep -i "backupadmin" unified_timeline.csv

# Find Event 4728 (group membership changes)
grep "4728" unified_timeline.csv | grep -i "domain admins"

# Find events around 11:12 UTC
grep "2026-02-03 11:12" unified_timeline.csv | grep -E "4720|4728|4732"

# Extract just the relevant fields
awk -F',' '/4728/ && /BackupAdmin/ {print $1, $3, $4, $5, $6}' unified_timeline.csv
```

---

## Red Flags / Indicators

### Suspicious Patterns to Detect:

1. **Rapid Account Creation + DA Addition**
   - Account created and added to Domain Admins within seconds
   - Normal admin workflow: Create → Test → Add to groups (takes minutes/hours)
   - Attacker workflow: Create → Immediately escalate (< 5 seconds)

2. **Non-Standard Account Names**
   - "BackupAdmin" - mimics legitimate naming conventions
   - Similar suspicious patterns: "TempAdmin", "SupportAdmin", "ServiceAdmin"
   - Legitimate accounts usually have documented change tickets

3. **Created by Recently Compromised Account**
   - jennifer.hayes performed DCSync at 11:08:45
   - Same account creates new DA at 11:12:15
   - Only 3.5 minutes between compromise and persistence

4. **After-Hours Activity**
   - Check if 11:12 UTC is within normal business hours
   - Legitimate admin changes usually during business hours with change approval

5. **Multiple Privilege Escalations**
   - Event 4728: Domain Admins
   - Event 4732: Local Administrators
   - Attacker wants maximum access

---

## Forensic Evidence Chain

### Timeline of Compromise:

```
10:47:33 - Initial compromise (sarah.mitchell phishing)
10:48:12 - Mimikatz credential dump #1
10:52:45 - Lateral movement to WORKSTATION-02
10:53:15 - Mimikatz credential dump #2 → jennifer.hayes (DA) obtained
11:08:45 - DCSync attack begins
11:08:46 - krbtgt hash extracted (Golden Ticket)
11:12:15 - BackupAdmin account created ← PERSISTENCE
11:12:16 - BackupAdmin → Domain Admins ← ANSWER TO QUESTION
11:12:18 - BackupAdmin → Local Admins
11:15:45 - Attacker logs out
```

### Why BackupAdmin?

**Attacker's Persistence Strategy:**
1. ✅ Legitimate-sounding name (blends in)
2. ✅ Created after obtaining all credentials (including krbtgt)
3. ✅ Domain Admin privileges (full access)
4. ✅ Independent of compromised accounts (survives password resets)
5. ✅ Can be accessed even if jennifer.hayes is disabled

---

## Answer Summary

**Q: Which specific user was added to Domain Admins?**

**A: BackupAdmin**

**Evidence:**
- Event 5137 at 11:12:15.123 UTC - Account created
- Event 4720 at 11:12:15.123 UTC - Account created (Security log)
- Event 4728 at 11:12:16.234 UTC - Added to Domain Admins ← **KEY EVENT**
- Event 4732 at 11:12:18.567 UTC - Added to Local Admins

**Created by:** jennifer.hayes (compromised Domain Administrator)

**Purpose:** Persistent backdoor access to the domain

**Threat:** BackupAdmin can:
- Access any system in the domain
- Create/modify users and groups
- Modify security policies
- Install software domain-wide
- Access all domain resources
- Survive remediation unless specifically identified and removed

---

## Remediation Checklist

When you identify BackupAdmin was added to Domain Admins:

- [ ] **Immediately disable BackupAdmin account**
- [ ] **Remove from Domain Admins group**
- [ ] **Remove from Administrators group**
- [ ] **Delete the account after forensic preservation**
- [ ] **Check for any actions taken by BackupAdmin**
  ```bash
  grep -i "backupadmin" unified_timeline.csv
  ```
- [ ] **Search for other suspicious accounts created around same time**
  ```bash
  grep "4720" unified_timeline.csv | grep "11:1[0-5]"
  ```
- [ ] **Review all Domain Admin group changes in last 30 days**
  ```bash
  grep "4728.*Domain Admins" unified_timeline.csv
  ```
- [ ] **Reset krbtgt password twice** (10-hour interval minimum)
- [ ] **Force password reset for jennifer.hayes and all DAs**
- [ ] **Audit all privileged account activity post-DCSync**

---

## Pro Tips for Incident Response

### During Investigation:

1. **Always correlate Event 4720 with Event 4728**
   - Look for account creation followed by immediate privilege escalation
   - Time delta < 1 minute = highly suspicious

2. **Check the creator's recent activity**
   - Was jennifer.hayes recently compromised? (Yes - 11:08 DCSync)
   - Is this creator authorized to add Domain Admins? (Check change management)

3. **Examine account attributes**
   - DisplayName: "Backup Administrator" - generic, mimics legit account
   - UPN: BackupAdmin@contoso.local
   - sAMAccountName: BackupAdmin

4. **Hunt for similar accounts**
   - Search for accounts created same day
   - Search for accounts with similar naming patterns
   - Look for other accounts added to privileged groups

5. **Timeline correlation**
   - DCSync (11:08) → Account creation (11:12) = 3.5 minutes
   - This is classic post-exploitation persistence

### Detection Engineering:

Create alert rules for:
```
EventID=4728 AND TargetGroup="Domain Admins" 
AND TimeDelta(4720, 4728) < 60 seconds
```

Monitor for:
- New accounts added to Domain Admins
- Account creation + group addition within 1 minute
- Privileged account activity after DCSync indicators
- Multiple group membership changes to same account rapidly

---

**Report Date:** February 6, 2026  
**Analysis Classification:** FORENSIC EVIDENCE  
**Confidence Level:** HIGH (Confirmed via multiple log sources)

---

**Key Takeaway:** Event ID 4728 clearly shows BackupAdmin was added to Domain Admins by jennifer.hayes at 11:12:16 UTC, immediately after being created at 11:12:15 UTC. This is a classic attacker persistence technique following domain compromise.
